!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAttr=t.createDom=t.getDomList=t.getDom=void 0,t.getDom=function(e){return document.querySelector(e)},t.getDomList=function(e){return document.querySelectorAll(e)},t.createDom=function(e="div",t,n){const i=document.createElement(e);return t&&(i.className=t),n&&(i.id=n),i},t.getAttr=function(e,t){return e.getAttribute(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lighter=t.rgbToHEX=t.hexToRGB=void 0;function i(e){if(!/^#[A-Fa-f0-9]{6}$/.test(e))return null;let t;return t="0x"+e.substring(1),{r:t>>16&255,g:t>>8&255,b:255&t}}function o(e){return`#${e.r.toString(16)}${e.g.toString(16)}${e.b.toString(16)}`}t.default={blue:"#b3e5fc",font:"#333333",line:"#c1c1c1",green:"#c5e1a5",red:"#ffcdd2",lingthBlue:"#e3f2fd",white:"#ffffff"},t.hexToRGB=i,t.rgbToHEX=o,t.lighter=function(e,t=5){const n=i(e);return o({r:Math.floor((n.r*t+255*(10-t))/10),g:Math.floor((n.g*t+255*(10-t))/10),b:Math.floor((n.b*t+255*(10-t))/10)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;t.Event=class{constructor({rect:e}){this.mobileEvent={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};const t=window&&window.navigator.userAgent||"";this.isMobile=!!t.toLowerCase().match(/iphone|mobile|andriod/),this.baseRect=e,this.isMobile&&document.body.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1})}add(e,t,n){e&&(t=this.isMobile&&this.mobileEvent[t]||t,e.addEventListener(t,e=>{if(this.isMobile){let i="touchend"===t?e.changedTouches[0]:e.touches[0];i.offsetX=i.clientX-this.baseRect.left,i.offsetY=i.clientY-this.baseRect.top,n(i)}else n(e)}))}}},function(e,t,n){"use strict";var i=n(7),o=n.n(i),s=n(8),r=n.n(s)()(o.a);r.push([e.i,".editor-container {\n    position: relative;\n}\n/* editor */\n.editor-page {\n    position: relative;\n    flex: 1;\n    z-index: 1;\n    background-color: #F3F4F8;\n}\n.editor-page > canvas {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    left: 0;\n    top: 0;\n    cursor: default;\n}\n\n/* contextmenu */\n.editor-contextmenu {\n    display: none;\n    position: fixed;\n    width: 100px;\n    padding: 5px 0;\n    background-color: #fff;\n    z-index: 9;\n    flex-direction: column;\n    border-radius: 2px;\n    overflow: hidden;\n}\n.editor-contextmenu.show {\n    display: flex;\n}\n.editor-contextmenu-item {\n    padding: 5px 10px;\n    cursor: default;\n    transition: color .2s ease;\n}\n.editor-contextmenu-item:hover {\n    color: #03a9f4;\n}\n","",{version:3,sources:["webpack://style/editor.css"],names:[],mappings:"AAAA;IACI,kBAAkB;AACtB;AACA,WAAW;AACX;IACI,kBAAkB;IAClB,OAAO;IACP,UAAU;IACV,yBAAyB;AAC7B;AACA;IACI,kBAAkB;IAClB,WAAW;IACX,YAAY;IACZ,OAAO;IACP,MAAM;IACN,eAAe;AACnB;;AAEA,gBAAgB;AAChB;IACI,aAAa;IACb,eAAe;IACf,YAAY;IACZ,cAAc;IACd,sBAAsB;IACtB,UAAU;IACV,sBAAsB;IACtB,kBAAkB;IAClB,gBAAgB;AACpB;AACA;IACI,aAAa;AACjB;AACA;IACI,iBAAiB;IACjB,eAAe;IACf,0BAA0B;AAC9B;AACA;IACI,cAAc;AAClB",sourcesContent:[".editor-container {\n    position: relative;\n}\n/* editor */\n.editor-page {\n    position: relative;\n    flex: 1;\n    z-index: 1;\n    background-color: #F3F4F8;\n}\n.editor-page > canvas {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    left: 0;\n    top: 0;\n    cursor: default;\n}\n\n/* contextmenu */\n.editor-contextmenu {\n    display: none;\n    position: fixed;\n    width: 100px;\n    padding: 5px 0;\n    background-color: #fff;\n    z-index: 9;\n    flex-direction: column;\n    border-radius: 2px;\n    overflow: hidden;\n}\n.editor-contextmenu.show {\n    display: flex;\n}\n.editor-contextmenu-item {\n    padding: 5px 10px;\n    cursor: default;\n    transition: color .2s ease;\n}\n.editor-contextmenu-item:hover {\n    color: #03a9f4;\n}\n"],sourceRoot:""}]),t.a=r},function(e,t,n){"use strict";function i(e,t,n,i){const{x:o,y:s,w:r,h:a}=e;return{x:o-r/2+(n+1)/(i+1)*r,y:"input"===t?s-a/2:s+a/2}}function o({x:e,y:t},{x:n,y:i},o=4){return Math.abs(e-n)<=o&&Math.abs(t-i)<=o}Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.compareEdge=t.checkInCircle=t.checkInNodeAnchor=t.getAnchorPos=t.randomID=void 0,t.randomID=function(){return Date.now().toString(16)},t.getAnchorPos=i,t.checkInNodeAnchor=function({x:e,y:t},n){const{input:s,output:r}=n.anchors;if(s)for(let r=0;r<s;r++){if(o({x:e,y:t},i(n,"input",r,s)))return[n,"input",r]}if(r)for(let s=0;s<r;s++){if(o({x:e,y:t},i(n,"output",s,r)))return[n,"output",s]}return null},t.checkInCircle=o,t.compareEdge=function(e,t){for(let n in e)if(e[n]!==t[n])return!1;return!0},t.logger=function(e){0}},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(11),t),o(n(16),t)},function(e,t,n){"use strict";var i,o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},s=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function a(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function c(e,t){for(var n={},i=[],o=0;o<e.length;o++){var s=e[o],c=t.base?s[0]+t.base:s[0],d=n[c]||0,h="".concat(c," ").concat(d);n[c]=d+1;var l=a(h),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==l?(r[l].references++,r[l].updater(u)):r.push({identifier:h,updater:g(u,t),references:1}),i.push(h)}return i}function d(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var o=n.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var r=s(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var h,l=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function u(e,t,n,i){var o=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=l(t,o);else{var s=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function f(e,t,n){var i=n.css,o=n.media,s=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var p=null,v=0;function g(e,t){var n,i,o;if(t.singleton){var s=v++;n=p||(p=d(t)),i=u.bind(null,n,s,!1),o=u.bind(null,n,s,!0)}else n=d(t),i=f.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=o());var n=c(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var o=a(n[i]);r[o].references--}for(var s=c(e,t),d=0;d<n.length;d++){var h=a(n[d]);0===r[h].references&&(r[h].updater(),r.splice(h,1))}n=s}}}},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e.exports=function(e){var t=i(e,4),n=t[1],o=t[3];if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),a="/*# ".concat(r," */"),c=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(c).concat([a]).join("\n")}return[n].join("\n")}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(i)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(o[r]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);i&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},function(e,t,n){"use strict";function i(e){if(void 0!==e.count)return e.count;e.count=0;const{children:t}=e;if(t)for(let n=0,o=t.length;n<o;n++)e.count+=i(t[n]);else e.count++;return e.count}Object.defineProperty(t,"__esModule",{value:!0}),t.figureNodeLevel=t.getLeavesCount=void 0,t.getLeavesCount=i,t.figureNodeLevel=function e(t,n=0){if(t.level=n,t.count=i(t),!t.children)return!1;for(let i=0,o=t.children.length;i<o;i++)e(t.children[i],n+1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor({selector:e}){this.events={},this.oToolbar=document.querySelector(e),this._bind()}registerCommands(e){this.events=Object.assign(Object.assign({},this.events),e)}_bind(){this.oToolbar.addEventListener("click",e=>{const t=e.target.getAttribute("data-command");if(!t)return;const n=this.events[t];n&&n(e)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0,n(12);const i=n(0),o=n(4),s=n(13),r=n(2),a=n(14),c=n(15);t.Editor=class{constructor({container:e,itempanel:t,page:n}){this.anchorStartPos={x:0,y:0},this.callback={selectedNodeChange:null,nodeAdded:null,nodeDeleted:null,edgeAdded:null,edgeDeleted:null},this.isMouseDown=!1,this.eventList=[["oItemPanel","mousedown","_beginAddNode"],["oItemPanel","mouseup","_mouseUp"],["oPage","mousedown","_mouseDownOnPage"],["oPage","mousemove","_mouseMove"],["oPage","mouseleave","_mouseLeavePage"],["oPage","mouseup","_mouseUpPage"],["oContainer","contextmenu","_preventDefaultMenu"]],this.mouseEventStartPos={x:0,y:0},this.commands={"del:node":"_delNodeCommand","del:edge":"_delEdgeCommand",clear:"_clear"},console.info("%csimple-dag-editor: created","color: #c5e1a5;font-weight: bold;"),this.oContainer=i.getDom(e),this.oItemPanel=i.getDom(t),this.oPage=i.getDom(n),this.shapes={},this.nodes=[],this.edges=[],this._init()}_init(){this._initCanvas(),this._bindEvents(),this._initCommand()}resize(){}_initPageConfig(){if(!this.oPage||!this.oContainer)throw Error("cannot find Editor editor container");this.oPage.classList.add("editor-page"),this.oContainer.classList.add("editor-container");let e=this.oPage.getBoundingClientRect();const t=window.devicePixelRatio||1;e=e.toJSON(),this.pageConfig=Object.assign(Object.assign({},e),{ratio:t})}_initCanvas(){this._initPageConfig();const{width:e,height:t,ratio:n}=this.pageConfig,o=i.createDom("canvas","editor-canvas");o.width=e*n,o.height=t*n;const r=o.cloneNode();r.style.pointerEvents="none",r.style.backgroundColor="transparent",this.mainCvs=new s.Canvas(o,{ratio:n,hasStore:!0}),this.dynamicCvs=new s.Canvas(r,{ratio:n}),this.oPage.appendChild(o),this.oPage.appendChild(r)}registerShape(e,t){this.shapes[e]=t}get selectedNode(){return this.__selectedNode}set selectedNode(e){e!==this.__selectedNode?(this.__selectedNode=e,this._renderTask("selected node change"),this.callback.selectedNodeChange&&this.callback.selectedNodeChange(e)):o.logger("no change")}get hoverNode(){return this.__hoverNode}set hoverNode(e){e!==this.__hoverNode&&(this.__hoverNode=e,this._renderTask("hover node change"))}_addNode(e){this.nodes.push(Object.assign(Object.assign({},e),{id:o.randomID()}));let t=this.nodes[this.nodes.length-1];this.callback.nodeAdded&&this.callback.nodeAdded(t),this.selectedNode=t}_updateNode(e){let t=this.nodes.findIndex(t=>t.id===e.id);if(t<0)return;let n=this.nodes.splice(t,1)[0];n=Object.assign({},e),this.nodes.push(n),this.selectedNode=n}_delNode(e){let t=this.nodes.findIndex(t=>t.id===e);if(t>-1){this.nodes.splice(t,1);let n=this._getRelatedEdge(e);n.length&&n.forEach(e=>{this._delEdge(e.id)}),this.selectedNode=null,this.callback.nodeDeleted&&this.callback.nodeDeleted(e)}}get selectedEdge(){return this.__selectedEdge}set selectedEdge(e){e!==this.__selectedEdge&&(this.__selectedEdge=e,this._renderTask("selected edge change"))}_addEdge([e,t],[n,i]){let s={source:e.id,sourceAnchorIndex:t,target:n.id,targetAnchorIndex:i};this.edges.find(e=>o.compareEdge(s,e))||(this.edges.push(Object.assign(Object.assign({},s),{id:o.randomID()})),this.callback.edgeAdded&&this.callback.edgeAdded(s))}_delEdge(e){let t=this.edges.findIndex(t=>t.id===e);if(t>-1){let[e]=this.edges.splice(t,1);this.callback.edgeDeleted&&this.callback.edgeDeleted(e)}}_clear(){this.nodes=[],this.edges=[],this._renderTask("clear")}_renderTask(e){this.renderTask&&cancelAnimationFrame(this.renderTask),this.renderTask=window.requestAnimationFrame(()=>{this._render(e)})}_render(e){e&&o.logger(`===render by: ${e}===`),this.mainCvs.clear(),this.mainCvs.preFill(),this.nodes.forEach(e=>{let t=this.selectedNode===e?"selected":this.hoverNode===e?"hover":null;this.mainCvs.paintNode(e,{status:t})}),this.edges.forEach(({source:e,sourceAnchorIndex:t,target:n,targetAnchorIndex:i,id:s})=>{const r=this.nodes.find(t=>t.id===e),a=this.nodes.find(e=>e.id===n);this.mainCvs.paintEdge(o.getAnchorPos(r,"output",t,r.anchors.output),o.getAnchorPos(a,"input",i,a.anchors.input),{id:s,selected:this.selectedEdge&&this.selectedEdge.id===s})})}on(e,t){this.callback.hasOwnProperty(e)&&(this.callback[e]=t)}update(e){}repaint(){this._renderTask("repaint")}getData(){return{nodes:this.nodes,edges:this.edges}}saveFile(e="simple-dag-editor-export-picture",t="jpeg"){return new Promise(n=>{this.getFileBlob(t).then(i=>{const o=URL.createObjectURL(i),s=document.createElement("a");s.download=`${e}.${t}`,s.href=o,s.click(),n(o)})})}getFileBlob(e){const{canvas:t}=this.mainCvs,n="image/"+e;return new Promise(e=>{t.toBlob(t=>{e(t)},n)})}_bindEvents(){const e=new r.Event({rect:this.pageConfig});for(let t of this.eventList)e.add(this[t[0]],t[1],this[t[2]].bind(this))}_beginAddNode(e){const t=e.target,n=i.getAttr(t,"data-shape");n&&(this.isMouseDown=!0,this.mouseDownType="add-node",this.selectedShape=this.shapes[n])}_mouseDownOnPage(e){this.isMouseDown=!0;const{offsetX:t,offsetY:n}=e;if(this.mouseEventStartPos={x:t,y:n},this.hoverNode)if(this.selectedNode=this.hoverNode,this.selectedEdge=null,this.hoverAnchor){const[e,t,n]=this.hoverAnchor;this.mouseDownType="output"===t?"add-edge":null,this.anchorStartPos=o.getAnchorPos(e,t,n,e.anchors[t])}else this.mouseDownType="move-node";else this.selectedNode=null,this.selectedEdge=this._getSelectedEdge({x:t,y:n}),this.mouseDownType="drag-canvas";this._triggerMenu(2===e.button,e)}_mouseMove(e){this.dynamicCvs.clear();const{offsetX:t,offsetY:n}=e,i=t-this.mouseEventStartPos.x,o=n-this.mouseEventStartPos.y,{tx:s,ty:r}=this.dynamicCvs.translateInfo;if(this.isMouseDown)switch(this.mouseDownType){case"add-node":this.dynamicCvs.paintNode(Object.assign(Object.assign({},this.selectedShape),{x:t-s,y:n-r}));break;case"move-node":this.dynamicCvs.paintNode(Object.assign(Object.assign({},this.selectedNode),{x:this.selectedNode.x+i,y:this.selectedNode.y+o}));break;case"add-edge":this.nodes.forEach(e=>{e.id!==this.selectedNode.id&&e.anchors&&this.dynamicCvs.paintActiveAnchors(e)}),this.dynamicCvs.paintEdge(this.anchorStartPos,{x:t,y:n},{needTranslate:!0});break;case"drag-canvas":this.mainCvs.clear(),this.mainCvs.transform(i,o),this.dynamicCvs.transform(i,o),this._render(),this.mainCvs.restore(),this.dynamicCvs.restore()}else{const e=this._getSelectedNode({x:t,y:n});if(this.hoverNode){let i=this.mainCvs.checkInNodeAnchor(this.hoverNode,{x:t,y:n});this.hoverAnchor=i,i||(this.hoverNode=e)}else this.hoverAnchor=null,this.hoverNode=e}}_mouseLeavePage(){this._mouseUp()}_mouseUpPage(e){if(!this.isMouseDown)return;const{offsetX:t,offsetY:n}=e,i=t-this.mouseEventStartPos.x,s=n-this.mouseEventStartPos.y,{tx:r,ty:a}=this.dynamicCvs.translateInfo;switch(this.mouseDownType){case"add-node":this._addNode(Object.assign(Object.assign({},this.selectedShape),{x:t-r,y:n-a}));break;case"move-node":if(Math.abs(i)<5&&Math.abs(s)<5)break;o.logger("move"),this._updateNode(Object.assign(Object.assign({},this.selectedNode),{x:this.selectedNode.x+i,y:this.selectedNode.y+s}));break;case"add-edge":this.nodes.forEach(e=>{if(e.id!==this.selectedNode.id){const i=this.mainCvs.checkInNodeAnchor(e,{x:t,y:n},{active:!0});i&&"input"===i[1]&&this._addEdge([this.hoverAnchor[0],this.hoverAnchor[2]],[e,i[2]])}});break;case"drag-canvas":this.mainCvs.translate(i,s),this.dynamicCvs.translate(i,s)}this._mouseUp()}_mouseUp(){this.isMouseDown=!1,this.mouseDownType=null,this.dynamicCvs.clear()}_initCommand(){const e=new a.Command({app:this}),{commands:t}=this;for(let n in t)e.register(n,this[t[n]]);this.command=e,this.contextmenu=new c.ContextMenu({app:this,command:e,container:this.oContainer})}_triggerMenu(e,t){if(e){let e={type:null};this.selectedNode?e.type="node":this.selectedEdge&&(e.type="edge"),this.contextmenu.attach(t,e)}else this.contextmenu.detach()}_preventDefaultMenu(e){e.preventDefault()}_delNodeCommand(){this._delNode(this.selectedNode.id)}_delEdgeCommand(){this._delEdge(this.selectedEdge.id),this.selectedEdge=null}_getSelectedNode({x:e,y:t}){const{nodes:n}=this;for(let i=n.length;i>0;i--){let o=n[i-1];if(this.mainCvs.checkInNode(o.id,{x:e,y:t}))return o}return null}_getSelectedEdge({x:e,y:t}){const{edges:n}=this;for(let i of n)if(this.mainCvs.checkOnEdge(i.id,{x:e,y:t}))return i;return null}_getRelatedEdge(e){let t=[];return this.edges.forEach(n=>{n.source!==e&&n.target!==e||t.push(n)}),t}}},function(e,t,n){"use strict";n.r(t);var i=n(6),o=n.n(i),s=n(3),r={insert:"head",singleton:!1};o()(s.a,r);t.default=s.a.locals||{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;const i=n(1),o=n(4);t.Canvas=class{constructor(e,{ratio:t=1,fillStyle:n=i.default.white,strokeStyle:o=i.default.line,hasStore:s}){this.canvas=e,this.ratio=t;const r=e.getContext("2d");r.fillStyle=n,r.strokeStyle=o,r.textAlign="center",r.textBaseline="middle",r.font=Math.max(10*t,12)+"px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,sans-serif",this.ctx=r,this.hasStore=s,this.paths={nodes:{},edges:{},anchors:{},activeAnchors:{}},this.translateInfo={x:0,y:0,tx:0,ty:0}}translate(e,t){const{ratio:n,ctx:i}=this;this.translateInfo.tx+=e,this.translateInfo.ty+=t,e*=n,t*=n,i.translate(e,t),this.translateInfo.x+=e,this.translateInfo.y+=t,o.logger(`===translate: (${this.translateInfo.x}, ${this.translateInfo.y})===`)}transform(e,t){const{ctx:n,ratio:i}=this;n.save(),n.transform(1,0,0,1,e*i,t*i)}restore(){this.ctx.restore()}paintNode(e,t){const{ctx:n,ratio:s}=this;let{x:r,y:a,w:c,h:d}=e;r*=s,a*=s,c*=s,d*=s;const h=r-c/2,l=a-d/2;n.save();const u=this._paintRoundRect(h+2*s,l+2*s,c,d,4*s);n.fillStyle="rgba(35,35,35,0.08)",n.fill(u),n.restore();const f=this._paintRoundRect(h,l,c,d,4*s);e.id&&this.hasStore&&(this.paths.nodes[e.id]=f),n.fill(f),n.save();const p=this._paintRoundRect(h,l,4*s,d,4*s,!0);if(n.fillStyle=e.color||i.default.blue,n.fill(p),n.restore(),e.id&&t&&t.status){n.save(),n.strokeStyle=e.color||i.default.blue,n.lineWidth=2,n.stroke(f);const{anchors:t}=e;this.paths.anchors[e.id]=[],this.paths.activeAnchors[e.id]=[],Object.keys(t).forEach(i=>{if(t[i])for(let s=0;s<t[i];s++){let r=o.getAnchorPos(e,i,s,t[i]),[a,c]=this._paintAnchor(r);n.fill(a),n.stroke(a),this.paths.anchors[e.id].push({type:i,index:s,path:a}),this.paths.activeAnchors[e.id].push({type:i,index:s,path:c})}}),n.restore()}n.save(),n.fillStyle=i.default.font,n.fillText(e.name||e.shape,r,a),n.restore()}_paintRoundRect(e,t,n,i,o,s){const r=new Path2D;return r.moveTo(e+o,t),s?r.lineTo(e+o,t+i):(r.arcTo(e+n,t,e+n,t+i,o),r.arcTo(e+n,t+i,e,t+i,o)),r.arcTo(e,t+i,e,t,o),r.arcTo(e,t,e+o,t,o),r.closePath(),r}checkInNode(e,t){const n=this.ratio,i=this.paths.nodes[e];let{x:o,y:s}=t;return o*=n,s*=n,i&&this.ctx.isPointInPath(i,o,s)}_paintAnchor({x:e,y:t}){const{ratio:n}=this;e*=n,t*=n;const i=new Path2D;i.arc(e,t,4*n,0,2*Math.PI,!1);const o=new Path2D;return o.arc(e,t,12*n,0,2*Math.PI,!1),[i,o]}checkInNodeAnchor(e,t,n){const i=this.ratio;let{x:o,y:s}=t;o*=i,s*=i;const r=n&&n.active?this.paths.activeAnchors[e.id]:this.paths.anchors[e.id];for(let t=0,n=r.length;t<n;t++){const n=r[t];if(this.ctx.isPointInPath(n.path,o,s))return[e,n.type,n.index]}return null}paintActiveAnchors(e){const{ctx:t}=this,{input:n}=e.anchors;if(n)for(let s=0;s<n;s++){let r=o.getAnchorPos(e,"input",s,n),[a,c]=this._paintAnchor(r);t.save(),t.fillStyle=i.lighter(e.color||i.default.blue),t.fill(c),t.restore(),t.fill(a),t.stroke(a)}}paintEdge({x:e,y:t},{x:n,y:i},o){const{ctx:s,ratio:r}=this;e*=r,t*=r,n*=r,i*=r,o.needTranslate&&(n-=this.translateInfo.x,i-=this.translateInfo.y);const a=new Path2D;s.beginPath(),a.moveTo(e,t);let c=Math.abs(i-t);const d=[e,t+c/4],h=[n,i-c/2];a.bezierCurveTo(d[0],d[1],h[0],h[1],n,i),o&&o.selected?(s.save(),s.lineWidth=2*r,s.stroke(a),s.restore()):s.stroke(a),o&&o.id&&this.hasStore&&(this.paths.edges[o.id]=a),s.closePath(),this._paintArrow({x:n,y:i})}checkOnEdge(e,t){const{ratio:n,ctx:i}=this,o=this.paths.edges[e];let{x:s,y:r}=t;s*=n,r*=n,i.save(),i.lineWidth=6*n;let a=o&&i.isPointInStroke(o,s,r);return i.restore(),a}_paintArrow({x:e,y:t}){const{ctx:n,ratio:o}=this;n.beginPath(),n.moveTo(e,t),n.lineTo(e-2*o,t-6*o),n.lineTo(e+2*o,t-6*o),n.save(),n.fillStyle=i.default.line,n.fill(),n.restore(),n.stroke(),n.closePath()}clear(){const{x:e,y:t}=this.translateInfo;this.ctx.clearRect(-e,-t,this.canvas.width,this.canvas.height)}preFill(){const{x:e,y:t}=this.translateInfo;this.ctx.save(),this.ctx.fillStyle="#F3F4F8",this.ctx.fillRect(-e,-t,this.canvas.width,this.canvas.height),this.ctx.restore()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0;t.Command=class{constructor({app:e}){this.app=e,this.task={}}register(e,t){if(this.task[e])throw Error(`command ${e} exist`);this.task[e]=t}execute(e,t){const n=this.task[e];n&&n.call(this.app,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextMenu=void 0;const i=n(0);t.ContextMenu=class{constructor({app:e,command:t,container:n}){this.app=e,this.command=t,this.container=n,this._init(),this._bind()}_init(){const e=this._createBody();this.body=e,this.container.appendChild(e)}_bind(){this.body.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("editor-contextmenu-item")){let e=i.getAttr(t,"data-command");this.command.execute(e),this.detach()}})}attach(e,{type:t}){switch(this.detach(),this.body.classList.add("show"),this.body.style.left=e.clientX+"px",this.body.style.top=e.clientY+"px",t){case"node":this.body.appendChild(this._createDelItem());break;case"edge":this.body.appendChild(this._createDelEdge());break;default:this.body.appendChild(this._createClearItem())}}detach(){this.body.innerHTML="",this.body.classList.remove("show")}_createBody(){return i.createDom("div","editor-contextmenu bxs","editor-contextmenu")}_createDelItem(){const e=i.createDom("div","editor-contextmenu-item");return e.setAttribute("data-command","del:node"),e.innerText="删除节点",e}_createDelEdge(){const e=i.createDom("div","editor-contextmenu-item");return e.setAttribute("data-command","del:edge"),e.innerText="删除边",e}_createClearItem(){const e=i.createDom("div","editor-contextmenu-item");return e.setAttribute("data-command","clear"),e.innerText="清空",e}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Mind",(function(){return v}));var i=n(0),o=n(9),s=n(1),r=n.n(s),a=n(10),c=n.n(a),d=n(2),h=n.n(d);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(){function e(t){var n=t.container,o=void 0===n?"#mind-map-container":n,s=t.data,a=void 0===s?{}:s,c=t.options,d=void 0===c?{}:c;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"options",{style:{fill:r.a.blue,line:r.a.line,font:r.a.font},lineType:"polygon",legends:null}),p(this,"nodeInfo",{height:26,minWidth:80,horizontalGap:100,verticalHeight:36,fontSize:12}),p(this,"translate",{x:0,y:0}),p(this,"mouseEvent",{isDown:!1,sx:0,sy:0}),p(this,"scale",10),!Object(i.getDom)(o))throw Error("null canvas container found");this.oCon=Object(i.getDom)(o),this.options=u(u({},this.options),d),this._init(),this._setData(a),this._render(),this._bindEvent()}var t,n,s;return t=e,(n=[{key:"_init",value:function(){var e=this.oCon.getBoundingClientRect(),t=e.width,n=e.height,o=e.left,s=e.top,r=window.devicePixelRatio||1;this.config={width:t,height:n,ratio:r,left:o,top:s},console.info("当前屏幕像素密度为".concat(r)),this._initNodeInfo(),this.options.toolbar&&this._initLegends(),this.options.toolbar&&this._initToolbar(this.options.toolbar);var a=Object(i.createDom)("canvas");a.width=t*r,a.height=n*r,this.oCanvas=a,this.ctx=a.getContext("2d"),this.ctx.font="".concat(this.nodeInfo.fontSize,"px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,sans-serif"),this.ctx.textBaseline="middle",this.ctx.textAlign="center",this.ctx.fillStyle=this.options.style.fill,this.ctx.strokeStyle=this.options.style.line,this._initTranslate(),this.oCon.appendChild(this.oCanvas)}},{key:"_initNodeInfo",value:function(){var e=this.config.ratio,t=this.nodeInfo;for(var n in t)t[n]=t[n]*e;t.fontSize=Math.max(10*e,12)}},{key:"_initTranslate",value:function(){this._translate(50*this.config.ratio,this.oCanvas.height/2)}},{key:"_translate",value:function(e,t){this.ctx.translate(e,t),this.translate.x+=e,this.translate.y+=t}},{key:"_reset",value:function(){this._clear(),this.scale=10,this._translate(-this.translate.x,-this.translate.y),this._initTranslate(),this._render()}},{key:"_repaint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._clear(),this.ctx.save();var n=this.scale/10;this.ctx.transform(n,0,0,n,e,t),this._render(),this.ctx.restore()}},{key:"_setData",value:function(e){this.data=e,Object(o.figureNodeLevel)(this.data)}},{key:"_render",value:function(){var e=this,t=this.data,n=[];n.push(t);for(var i=this.nodeInfo,o=i.horizontalGap,s=i.verticalHeight,r=this.options.lineType,a=function(){var i=n.shift();0===i.level&&e._paintNode(t,{ox:0,oy:0});var a=i.children;if(!a||!a.length)return"continue";"polygon"===r&&e._paintLine({x:i.end,y:i.y},{x:i.end+o/2,y:i.y});var c=a.length;a.forEach((function(t,d){var h=t.count*s/2;h+=d>0?a[d-1].count*s/2+a[d-1].y:i.y-i.count*s/2,e._paintNode(t,{ox:i.end+o,oy:h}),"polygon"===r?(0!==d&&d!==c-1||e._paintLine({x:i.end+o/2,y:i.y},{x:i.end+o/2,y:t.y}),e._paintLine({x:i.end+o/2,y:t.y},{x:t.x,y:t.y})):e._paintCurve({x:i.end,y:i.y},t),n.push(t)}))};n.length;)a()}},{key:"_paintNode",value:function(e,t){var n=t.ox,i=t.oy,o=this.ctx,s=this.options,r=this.nodeInfo,a=r.height,c=r.minWidth,d=o.measureText(e.text),h=Math.max(d.width+20*this.config.ratio,c);if(s.legends&&s.legends[e.type]){var l=s.legends[e.type].color;o.save(),o.fillStyle=l,o.fillRect(n,i-a/2,h,a),o.restore()}else o.fillRect(n,i-a/2,h,a);o.save(),o.fillStyle=s.style.font,o.fillText(e.text,n+h/2,i),o.restore(),e.x=n,e.y=i,e.end=n+h}},{key:"_paintLine",value:function(e,t){var n=this.ctx,i=e.x,o=e.y,s=t.x,r=t.y;n.beginPath(),n.moveTo(i,o),n.lineTo(s,r),n.stroke(),n.closePath()}},{key:"_paintCurve",value:function(e,t){var n=this.ctx,i=e.x,o=e.y,s=t.x,r=t.y;n.beginPath(),n.moveTo(i,o);var a=[(i+s)/2,o],c=[i,r];n.bezierCurveTo(a[0],a[1],c[0],c[1],s,r),n.stroke(),n.closePath()}},{key:"_clear",value:function(){var e=this.translate,t=e.x,n=e.y;this.ctx.clearRect(-t,-n,this.oCanvas.width,this.oCanvas.height)}},{key:"_bindEvent",value:function(){var e=this,t=new h.a({rect:this.config}),n=this.oCanvas;t.add(n,"mousedown",this._mouseDown.bind(this)),t.add(n,"mouseup",this._mouseUp.bind(this)),t.add(n,"mousemove",(function(t){requestAnimationFrame(e._mouseMove.bind(e,t))})),this.event=t}},{key:"_mouseDown",value:function(e){var t=e.offsetX,n=e.offsetY,i=this.config.ratio,o=this.scale/10;this.mouseEvent.isDown=!0,this.mouseEvent.sx=t*i*o,this.mouseEvent.sy=n*i*o}},{key:"_mouseMove",value:function(e){var t=this.mouseEvent,n=t.isDown,i=t.sx,o=t.sy,s=this.scale/10;if(n){var r=e.offsetX,a=e.offsetY,c=this.config.ratio,d=r*c*s-i,h=a*c*s-o;this._repaint(d,h)}}},{key:"_mouseUp",value:function(e){var t=e.offsetX,n=e.offsetY,i=this.mouseEvent,o=i.sx,s=i.sy,r=this.config.ratio,a=this.scale/10;this.mouseEvent.isDown=!1;var c=t*r*a-o,d=n*r*a-s;this._translate(c,d)}},{key:"_zoomIn",value:function(){this.scale<15&&this.scale++,this._repaint(),console.info("当前缩放比例为".concat(this.scale/10))}},{key:"_zoomOut",value:function(){this.scale>5&&this.scale--,this._repaint(),console.info("当前缩放比例为".concat(this.scale/10))}},{key:"_initToolbar",value:function(e){this.toolbar=new c.a({selector:e}),this.toolbar.registerCommands({"zoom-in":this._zoomIn.bind(this),"zoom-out":this._zoomOut.bind(this),reset:this._reset.bind(this),"switch-line":this._switchLine.bind(this)})}},{key:"_initLegends",value:function(){var e=this.options.legends,t=Object(i.createDom)("div","legends-container"),n="";for(var o in e){var s=e[o];n+='<span class="legend-item" style="background-color: '.concat(s.color,'">').concat(s.name,"</span>")}t.innerHTML=n,this.oCon.appendChild(t)}},{key:"_switchLine",value:function(e){var t="curve"===this.options.lineType?"polygon":"curve";this.options.lineType=t,this._repaint()}}])&&f(t.prototype,n),s&&f(t,s),e}()},,function(e,t,n){"use strict";n.r(t);var i=n(5),o={text:"Platform",children:[{text:"实验",children:[{text:"DAG图",children:[{text:"@antV/g6-editor",type:"tech"},{text:"定制化UI",children:[{text:"原始API延伸",type:"tech"},{text:"上层canvas自定义",type:"tech"}]},{text:"Tensorflow",type:"todo",children:[{text:"深度网络可视化",type:"tech"}]},{text:"更多框架接入/拓展",type:"todo"}]},{text:"参数配置",children:[{text:"算子参数",children:[{text:"算子组件抽象",type:"tech",children:[{text:"UI封装",type:"tech"},{text:"逻辑解耦",type:"tech"}]},{text:"自定义算子",children:[{text:"自定义组件",type:"tech"},{text:"自定义参数",type:"tech"}]}]},{text:"实验参数"}]},{text:"数据流",children:[{text:"数据继承",children:[{text:"准确性",children:[{text:"超集 --\x3e 严格收敛",type:"tech"}]},{text:"高效性",children:[{text:"缓存",type:"tech"}]}]},{text:"数据验证",children:[{text:"表单验证",type:"tech"},{text:"逻辑验证",type:"tech"}]},{text:"数据扩展",children:[{text:"字段类型",type:"tech"},{text:"新字段",type:"tech"}]}]},{text:"版本/快照",children:[{text:"管理"},{text:"切换"}]}]},{text:"任务调度",children:[{text:"调度管理",children:[{text:"调度配置",children:[{text:"不同类型算子配置抽象",type:"tech"}]},{text:"调度周期",children:[{text:"cron 表达式",children:[{text:"用户输入 ->(降低成本提高体验)-> 可视化配置",type:"tech"}]},{text:"其他",type:"todo"}]}]},{text:"任务执行",children:[{text:"部分执行调度",type:"todo",children:[{text:"数据流分隔",type:"tech"},{text:"状态保存",type:"tech"}]},{text:"执行结果",children:[{text:"结果数据(动态)可视化",type:"tech"},{text:"模型评估/对比",type:"todo"}]},{text:"日志",children:[{text:"展示/筛选/过滤"},{text:"排查/定位",type:"todo",children:[{text:"定位到具体执行节点",type:"tech"},{text:"定位到具体结果展示",type:"tech"}]},{text:"重跑"}]}]}]}]},s=n(1),r=n.n(s);new i.Mind({data:o,options:{toolbar:"#toolbar",legends:{default:{name:"业务场景",color:r.a.blue},tech:{name:"技术应用",color:r.a.green},todo:{name:"TODO",color:r.a.red}},lineType:"curve"}});var a=document.getElementById("code-btn"),c=document.querySelector(".popup-bg");a.addEventListener("click",(function(){var e=document.querySelector(".popup");e&&e.classList.add("show")})),c.addEventListener("click",(function(){var e=document.querySelector(".popup");e&&e.classList.remove("show")}))}]);
//# sourceMappingURL=mind.build.js.map